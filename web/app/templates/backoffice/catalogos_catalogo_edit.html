{% extends "backoffice/_layout.html" %}

{% block content %}
<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">Catálogos<i class="fa fa-long-arrow-right  fa-fw" aria-hidden="true"></i>Edição</h1>
    </div>
    <!-- /.col-lg-12 -->
</div>

<div id="informationDiv" >
</div>

<div class="module-content">
    <form method="post" id="formCatalogo" name="formCatalogo">
        {% with messages = get_flashed_messages() %}
           {% if messages %}
           <div class="alert alert-success alert-dismissible" role="alert">
              <a class="close" data-dismiss="alert">×</a>
              {% for message in messages %}
                 {{ message }}
              {% endfor %}
           </div>
           {% endif %}
        {% endwith %}

        {% if error %}
           <div class="alert alert-danger alert-dismissible" role="alert">
              <a class="close" data-dismiss="alert">×</a>
              <h4 class="alert-heading">Erros:</h4>
              <ul>
             {% if error and error.Message %}
               <li>{{ error.Message }}</li>
             {% endif %}
             {% for field in form if field.widget.input_type != 'hidden' %}
               {% if field.errors %}
                  <li><strong>{{ field.label.text }}</strong>:{% for error in field.errors %} {{ error }}.{% endfor %}</li>
               {% endif %}
             {% endfor %}
              </ul>
           </div>
        {% endif %}

        {{ form.csrf_token }}

        <fieldset>
            <!--
            <legend>Edição de Catálogo</legend>
            -->

            <div class="row">
                <div class="col-md-2">
                    <label>Código:</label>
                    <input type="text" name="codigo" id="codigo" class="form-control input-block-level" value="{{ form.codigo.data or '' }}" />
                </div>
                <div class="col-md-8">
                    <label>Título:</label>
                    <input type="text" name="titulo" id="titulo" class="form-control input-block-level" value="{{ form.titulo.data or '' }}" />
                </div>
                <div class="col-md-2">
                    <label>Tipo:</label>
                    <select name="tipo" id="tipo" class="form-control input-block-level">
                        <option value=""></option>
                        {% set tipos = ['Geonetwork', 'Geoportal'] %}
                        {% for t in tipos %}
                        <option value="{{ t }}" {% if t == form.tipo.data %}selected{% endif %}>{{ t }}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <label>Descrição:</label>
                    <textarea name="descricao" id="descricao" class="form-control input-block-level" rows="4">{{ form.descricao.data or '' }}</textarea>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <label>Url Base:</label>
                    <input type="text" name="url_base" id="url_base" class="form-control input-block-level" value="{{ form.url_base.data or '' }}" />
                </div>
                <div class="col-md-6">
                    <label>Url CSW:</label>
                    <input type="text" name="url_csw" id="url_csw" class="form-control input-block-level" value="{{ form.url_csw.data or '' }}" />
                </div>
            </div>

            <div class="row">
                <div class="col-md-2">
                    <label>&nbsp;</label>
                    <label class="checkbox" style="padding-left: 30px">
                        <input name="autenticacao" type="checkbox" value="{{ form.autenticacao.data or '' }}" {% if form.autenticacao.data %}checked{% endif %} />{{ form.autenticacao.label.text }}
                    </label>
                </div>
                <div class="col-md-2">
                    <label>Utilizador:</label>
                    <input type="text" name="username" id="username" class="form-control input-block-level" value="{{ form.username.data or '' }}" />
                </div>
                <div class="col-md-2">
                    <label>Password:</label>
                    <input type="password" name="password" id="password" class="form-control input-block-level" value="{{ form.password.data or '' }}" />
                </div>
                <div class="col-md-1">
                </div>
                <div class="col-md-1">
                    <label>&nbsp;</label>
                    <label class="checkbox">
                        <input name="portal" type="checkbox" value="{{ form.portal.data or '' }}" {% if form.portal.data %}checked{% endif %} />{{ form.portal.label.text }}
                    </label>
                </div>
                <div class="col-md-1">
                    <label>&nbsp;</label>
                    <label class="checkbox">
                        <input name="activo" type="checkbox" value="{{ form.activo.data or '' }}" {% if form.activo.data %}checked{% endif %} />{{ form.activo.label.text }}
                    </label>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <label>Ficheiro de Transformação de Resultados (XSLT):</label>
                    <input type="text" name="xslt_results_file" id="xslt_results_file" class="form-control input-block-level" value="{{ form.xslt_results_file.data or '' }}" />
                </div>
                <div class="col-md-6">
                    <label>Ficheiro de Transformação de Ficha (XSLT):</label>
                    <input type="text" name="xslt_metadata_file" id="xslt_metadata_file" class="form-control input-block-level" value="{{ form.xslt_metadata_file.data or '' }}" />
                </div>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <label>XSLT de Transformação de Resultados:</label>
                    <textarea name="xslt_results" id="xslt_results" class="form-control input-block-level" rows="15">{{ form.xslt_results.data or '' }}</textarea>
                </div>
                <div class="col-md-6">
                    <label>XSLT de Transformação de Ficha:</label>
                    <textarea name="xslt_metadata" id="xslt_metadata" class="form-control input-block-level" rows="15">{{ form.xslt_metadata.data or '' }}</textarea>
                </div>
            </div>

            <div style="margin-bottom: 50px">
            </div>

            <div class="row">
                <div class="col-md-12" style="text-align: right">
                    <button type="button" class="btn btn-default" onclick="location.href='{{ url_for('backoffice.catalogos') }}'" >Voltar</button>
                    <button type="submit" class="btn btn-primary">Gravar</button>
                </div>
            </div>

        </fieldset>

        <div style="margin-bottom: 50px">
        </div>

    </form>
</div>
{% endblock %}

{% block post_script %}

<script type="text/javascript">
(function ($) {
    $.fn.extend({
        //pass the options variable to the function
        informationModal: function (options) {
            var html = '<div class="modal fade" id="infoContainer" tabindex="-1" role="dialog" aria-hidden="true">' +
            '<div class="modal-content">' +
            '<div class="modal-header"><a class="close" data-dismiss="modal">×</a>' +
            '<h3>#Heading#</h3></div><div class="modal-body">' +
            '<div class="#MessageClass#">#Body#</div></div><div class="modal-footer">' +
            '<a href="#" class="btn btn-primary" data-dismiss="modal" id="infoCloseButton">Fechar</a></div></div><div>';

            var defaults = {
                heading: 'Informação',
                body: '',
                messageClass: 'alert alert-info',
                callback: null
            };

            $('#infoCloseButton', this).unbind();
            $('#informationDiv').unbind();

            var options = $.extend(defaults, options);
            html = html.replace('#Heading#', options.heading).replace('#Body#', options.body).replace('#MessageClass#', options.messageClass);

            $(this).html(html);
            $("#infoContainer", this).modal('show');
            var context = $(this);
            $('#infoCloseButton', this).click(function () {
                $("#infoContainer", context).modal('hide');

                if (options.callback != null)
                    options.callback();
            });
        }
    });
})(jQuery);
</script>

{% endblock %}


